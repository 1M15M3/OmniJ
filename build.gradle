apply plugin: 'java'
apply plugin: 'groovy'
apply plugin: 'application'

sourceCompatibility = 1.7
version = '0.1'

repositories {
    mavenCentral()
}

dependencies {
    compile 'com.fasterxml.jackson.core:jackson-core:2.3.2'
    compile 'com.fasterxml.jackson.core:jackson-databind:2.3.3'
    compile "org.codehaus.groovy:groovy-all:2.3.3"

    testCompile "org.codehaus.groovy:groovy-all:2.3.3"
    testCompile "org.spockframework:spock-core:0.7-groovy-2.0"

}

mainClassName = "GetBlockCount"

jar {
    manifest {
        attributes 'Implementation-Title': 'GetBlockCount', 'Implementation-Version': version, 'Main-Class': mainClassName
    }
}

task startRegtest(type:Exec) {
  executable 'bitcoind'
  args '-regtest', ' -server'
}

def homePath = System.properties['user.home']
def roboLibPath = "robolib"

task copyToRoboLib(type: Copy) {
    into roboLibPath
    from configurations.runtime
}

task roboCompile(type:Exec, dependsOn: [classes, copyToRoboLib]) {
    executable "${homePath}/robovm-0.0.11/bin/robovm"
    args '-verbose', '-debug',
            '-cp', "build/classes/main:${roboLibPath}/jackson-core-2.3.3.jar:${roboLibPath}/jackson-databind-2.3.3.jar:${roboLibPath}/jackson-annotations-2.3.0.jar",
            '-d', 'build',
            'GetBlockCount'
}

task roboRun(type:Exec, dependsOn: roboCompile) {
    executable "build/GetBlockCount"
    args '-rvm:log=debug'
}
